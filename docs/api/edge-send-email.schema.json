{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://smartflytt.se/api/edge-send-email.schema.json",
  "title": "Send Email Edge Function",
  "description": "Schema for the send-email edge function request and response",
  "type": "object",
  "definitions": {
    "sendEmailRequest": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["customer_confirmation", "admin_notification", "partner_lead"],
          "description": "Type of email to send"
        },
        "recipientEmail": {
          "type": "string",
          "format": "email",
          "description": "Recipient's email address"
        },
        "leadData": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string",
              "format": "uuid",
              "description": "Lead UUID"
            },
            "name": {
              "type": "string",
              "minLength": 1,
              "maxLength": 100,
              "description": "Customer name"
            },
            "email": {
              "type": "string",
              "format": "email",
              "description": "Customer email"
            },
            "phone": {
              "type": "string",
              "pattern": "^(\\+46|0)([1-9]\\d{1,2}[-\\s]?\\d{2,3}[-\\s]?\\d{2,3}|\\d{2,3}[-\\s]?\\d{2,3}[-\\s]?\\d{2,3})$",
              "description": "Swedish phone number"
            },
            "moveDate": {
              "type": "string",
              "format": "date",
              "description": "Preferred move date"
            },
            "fromAddress": {
              "$ref": "#/definitions/address"
            },
            "toAddress": {
              "$ref": "#/definitions/address"
            },
            "volume": {
              "type": "number",
              "minimum": 0.1,
              "maximum": 1000,
              "description": "Volume in cubic meters"
            },
            "elevator": {
              "type": "string",
              "enum": ["båda", "från", "till", "ingen"],
              "description": "Elevator availability"
            },
            "priceCalculation": {
              "$ref": "#/definitions/priceCalculation"
            },
            "additionalInfo": {
              "type": "string",
              "maxLength": 2000,
              "description": "Additional information from customer"
            }
          },
          "required": ["id", "name", "email", "phone", "moveDate", "fromAddress", "toAddress", "volume", "elevator"],
          "additionalProperties": false
        }
      },
      "required": ["type", "recipientEmail", "leadData"],
      "additionalProperties": false
    },
    "address": {
      "type": "object",
      "properties": {
        "street": {
          "type": "string",
          "minLength": 1,
          "description": "Street address"
        },
        "postal": {
          "type": "string",
          "pattern": "^\\d{3}\\s?\\d{2}$",
          "description": "Swedish postal code"
        },
        "city": {
          "type": "string",
          "minLength": 1,
          "description": "City name"
        }
      },
      "required": ["street", "postal", "city"],
      "additionalProperties": false
    },
    "priceCalculation": {
      "type": "object",
      "properties": {
        "startFee": {
          "type": "integer",
          "minimum": 0,
          "description": "Base start fee in SEK"
        },
        "elevatorFee": {
          "type": "integer",
          "minimum": 0,
          "description": "Elevator fee in SEK"
        },
        "volumeCost": {
          "type": "integer",
          "minimum": 0,
          "description": "Volume-based cost in SEK"
        },
        "distanceCost": {
          "type": "integer",
          "minimum": 0,
          "description": "Distance-based cost in SEK"
        },
        "remoteStartSurcharge": {
          "type": "integer",
          "minimum": 0,
          "description": "Remote start surcharge in SEK"
        },
        "longDistanceSurcharge": {
          "type": "integer",
          "minimum": 0,
          "description": "Long distance surcharge in SEK"
        },
        "totalPrice": {
          "type": "integer",
          "minimum": 0,
          "description": "Total price in SEK"
        }
      },
      "required": ["startFee", "elevatorFee", "volumeCost", "distanceCost", "remoteStartSurcharge", "longDistanceSurcharge", "totalPrice"],
      "additionalProperties": false
    },
    "sendEmailResponse": {
      "type": "object",
      "properties": {
        "success": {
          "type": "boolean",
          "description": "Whether the email was sent successfully"
        },
        "messageId": {
          "type": "string",
          "description": "SendGrid message ID (if successful)"
        },
        "error": {
          "type": "string",
          "description": "Error message (if unsuccessful)"
        },
        "requestId": {
          "type": "string",
          "format": "uuid",
          "description": "Unique request identifier for tracing"
        }
      },
      "required": ["success", "requestId"],
      "additionalProperties": false
    }
  },
  "properties": {
    "request": {
      "$ref": "#/definitions/sendEmailRequest"
    },
    "response": {
      "$ref": "#/definitions/sendEmailResponse"
    }
  }
}